import{Ba as P,Ca as S,Da as b,a,b as n,e as l,h as c,i as v,ia as d,l as u,o as i,pa as f,qa as m,v as h,w as g}from"./chunk-4DXK4BSP.js";var w=class r{constructor(){this.http=i(m);this.settingsService=i(b);this.authService=i(S);this.notificationService=i(P);this.postsWritable=h([]);this.posts=this.postsWritable.asReadonly();this.apiUrl=d(()=>this.settingsService.settings().dataSourceUrl);g(()=>{this.loadPostsFromServer(this.apiUrl())})}loadPostsFromServer(e){if(!e){this.postsWritable.set([]);return}this.http.get(`${e}?resource=posts`).pipe(c(t=>(console.error(`Failed to load blog posts from ${e}:`,t),this.notificationService.show("Failed to load posts from server.","error"),l([])))).subscribe(t=>{this.postsWritable.set(t)})}savePostsToServer(e,t){let s=this.apiUrl();if(!s){console.error("Cannot save posts: API URL is not set."),this.notificationService.show("Cannot save: API URL is not configured.","error");return}let o=this.authService.getToken();if(!o){console.error("Cannot save posts: User is not authenticated.");return}let y=new f({"Content-Type":"application/json",Authorization:`Bearer ${o}`});this.http.post(`${s}?resource=posts`,e,{headers:y}).pipe(v(()=>{this.notificationService.show(t)}),c(p=>(console.error(`Failed to save posts to ${s}:`,p),this.notificationService.show("Failed to save posts to the server.","error"),p.status===403&&(this.notificationService.show("Your session has expired. Please log in again.","error"),this.authService.logout()),l(null)))).subscribe()}slugify(e){return e.toString().toLowerCase().trim().replace(/\s+/g,"-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-")}addPost(e){let t=n(a({},e),{id:Date.now().toString(),publicationDate:new Date().toISOString(),slug:this.slugify(e.title)}),s=[t,...this.posts()];return this.postsWritable.set(s),this.savePostsToServer(s,"Post created successfully!"),t}updatePost(e){let t=n(a({},e),{slug:this.slugify(e.title)}),s=this.posts().map(o=>o.id===t.id?t:o);return this.postsWritable.set(s),this.savePostsToServer(s,"Post saved successfully!"),t}deletePost(e){let t=this.posts().filter(s=>s.id!==e);this.postsWritable.set(t),this.savePostsToServer(t,"Post deleted successfully!")}static{this.\u0275fac=function(t){return new(t||r)}}static{this.\u0275prov=u({token:r,factory:r.\u0275fac,providedIn:"root"})}};export{w as a};
